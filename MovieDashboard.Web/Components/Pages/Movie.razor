@page "/movie"
@using MovieDashboard.Web
@using MudBlazor
@attribute [StreamRendering(true)]
@attribute [OutputCache(Duration = 5)]

@inject MovieDataApiClient MovieApi

<PageTitle>Movie</PageTitle>

<h1>Movie Details</h1>


@if (movies == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <MudTable Items="@movies" Hover="true" Breakpoint="Breakpoint.Sm">
        <ColGroup>
            <col style="width:100px;" />
            <col style="width:50px;" />
            <col />
            <col />
            <col />
            <col />
        </ColGroup>
        <HeaderContent>
            <MudTh></MudTh>
            <MudTh>Id</MudTh>
            <MudTh>Title</MudTh>
            <MudTh>Director</MudTh>
            <MudTh>Release Date</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd>
                <MudButton Variant="Variant.Outlined" Size="Size.Small" OnClick="@(() => ShowBtnPress(context.Id))">@((context.ShowDetails == true)? "Hide" : "Show") Characters</MudButton>
            </MudTd>
            <MudTd DataLabel="Id">@context.Id</MudTd>
            <MudTd DataLabel="Title">@context.Title</MudTd>
            <MudTd DataLabel="Director">@context.Director</MudTd>
            <MudTd DataLabel="Release Date">@context.ReleaseDate?.ToShortDateString()</MudTd>
        </RowTemplate>
        <ChildRowContent>
            @if (context.ShowDetails)
            {
                <MudTr>
                    <td colspan="4">
                        <MudCard Elevation="0">
                            <MudCardHeader>
                                <CardHeaderContent>
                                    <MudText Typo="Typo.body1">Characters for <strong>@context.Title</strong></MudText>
                                </CardHeaderContent>
                            </MudCardHeader>
                        </MudCard>
                        <MudCardContent Class="pa-0">
                            <MudTable Items="@context.Characters?.ToList()" Context="CharacterContext" Hover="true" Breakpoint="Breakpoint.Sm" Elevation="0">
                                <ColGroup>
                                    <col />
                                    <col />
                                </ColGroup>
                                <HeaderContent>
                                    <MudTh>Name</MudTh>
                                    <MudTh>Actor</MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd DataLabel="Name">@CharacterContext.Name</MudTd>
                                    <MudTd DataLabel="Actor">@CharacterContext.Actor</MudTd>
                                </RowTemplate>
                            </MudTable>
                        </MudCardContent>
                    </td>
                </MudTr>
            }
        </ChildRowContent>
    </MudTable>
}

@code {
    private MovieDashboard.Web.Movie[]? movies;

    protected override async Task OnInitializedAsync()
    {
        movies = await MovieApi.GetMovieDataAsync();
    }

    private void ShowBtnPress(int movieId)
    {
        Console.WriteLine("Hello world!");
        MovieDashboard.Web.Movie? tmpMovie = movies?.FirstOrDefault(m => m.Id == movieId);
        tmpMovie!.ShowDetails = !tmpMovie.ShowDetails;
    }
}